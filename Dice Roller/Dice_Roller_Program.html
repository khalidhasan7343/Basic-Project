<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dice Roller V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@800&family=Inter:wght@400;600;800&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .mono {
        font-family: "JetBrains Mono", monospace;
      }

      /* === 3D SCENE & DICE === */
      .scene {
        perspective: 600px;
      }

      .die {
        width: 100px;
        height: 100px;
        background: linear-gradient(145deg, #ffffff, #e6e6e6);
        border-radius: 16px;
        box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.05),
          0 15px 25px -5px rgba(0, 0, 0, 0.3);
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(3, 1fr);
        padding: 10px;
        gap: 2px;
        /* Transition for smooth showing/hiding */
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      .pip {
        background-color: #0f172a;
        border-radius: 50%;
        margin: 3px;
        box-shadow: inset 0 2px 3px rgba(0, 0, 0, 0.4);
        opacity: 0;
        transform: scale(0.5);
        transition: all 0.2s;
      }
      .pip.show {
        opacity: 1;
        transform: scale(1);
      }

      /* Animations */
      @keyframes tumble {
        0% {
          transform: rotateX(0) rotateY(0) rotateZ(0);
        }
        25% {
          transform: rotateX(180deg) rotateY(90deg) rotateZ(45deg);
        }
        50% {
          transform: rotateX(360deg) rotateY(180deg) rotateZ(90deg);
        }
        100% {
          transform: rotateX(720deg) rotateY(360deg) rotateZ(0);
        }
      }
      .is-rolling {
        animation: tumble 0.6s ease-in-out;
      }

      /* Critical Hit Glow */
      .crit-glow {
        text-shadow: 0 0 20px #fbbf24, 0 0 10px #f59e0b;
        color: #fef3c7 !important;
      }

      /* History Item Animation */
      .history-item {
        animation: slideIn 0.3s forwards;
        opacity: 0;
        transform: translateX(-20px);
      }
      @keyframes slideIn {
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
    </style>
  </head>
  <body
    class="bg-slate-950 flex h-screen items-center justify-center p-4 overflow-hidden"
  >
    <div
      class="bg-slate-900 w-full max-w-md rounded-3xl p-6 shadow-2xl border border-slate-800 relative flex flex-col items-center"
    >
      <div
        class="bg-slate-950 p-1 rounded-xl flex gap-1 mb-8 shadow-inner border border-slate-800"
      >
        <button
          onclick="setDiceCount(1)"
          id="btn1"
          class="px-6 py-2 rounded-lg text-sm font-bold transition-all bg-indigo-600 text-white shadow-lg"
        >
          1 Die
        </button>
        <button
          onclick="setDiceCount(2)"
          id="btn2"
          class="px-6 py-2 rounded-lg text-sm font-bold transition-all text-slate-400 hover:text-white"
        >
          2 Dice
        </button>
      </div>

      <div
        class="scene flex gap-6 mb-10 h-[120px] items-center justify-center w-full transition-all"
      >
        <div id="die1" class="die">
          <div class="pip" id="d1p1"></div>
          <div class="pip" id="d1p2"></div>
          <div class="pip" id="d1p3"></div>
          <div class="pip" id="d1p4"></div>
          <div class="pip" id="d1p5"></div>
          <div class="pip" id="d1p6"></div>
          <div class="pip" id="d1p7"></div>
          <div class="pip" id="d1p8"></div>
          <div class="pip" id="d1p9"></div>
        </div>

        <div id="die2" class="die hidden scale-0 opacity-0">
          <div class="pip" id="d2p1"></div>
          <div class="pip" id="d2p2"></div>
          <div class="pip" id="d2p3"></div>
          <div class="pip" id="d2p4"></div>
          <div class="pip" id="d2p5"></div>
          <div class="pip" id="d2p6"></div>
          <div class="pip" id="d2p7"></div>
          <div class="pip" id="d2p8"></div>
          <div class="pip" id="d2p9"></div>
        </div>
      </div>

      <div class="text-center mb-6">
        <div
          class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-1"
        >
          Total Result
        </div>
        <div
          id="totalDisplay"
          class="mono text-5xl text-white font-black transition-all"
        >
          0
        </div>
      </div>

      <button
        id="rollBtn"
        onclick="rollAll()"
        class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 rounded-xl shadow-[0_10px_20px_-5px_rgba(79,70,229,0.4)] transition-all active:scale-[0.98] border-t border-white/20 mb-6"
      >
        ROLL
      </button>

      <div class="w-full border-t border-slate-800 pt-4">
        <div class="text-xs text-slate-500 font-bold mb-2 ml-1">HISTORY</div>
        <div
          id="historyList"
          class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide mask-fade"
        >
          <div class="text-slate-600 text-xs italic py-2">No rolls yet...</div>
        </div>
      </div>
    </div>

    <script>
      /* CONFIGURATION */
      const faceConfig = {
        1: [5],
        2: [1, 9],
        3: [1, 5, 9],
        4: [1, 3, 7, 9],
        5: [1, 3, 5, 7, 9],
        6: [1, 3, 4, 6, 7, 9],
      };

      let mode = 1; // 1 or 2 dice
      let isRolling = false;

      /* DOM ELEMENTS */
      const die1 = document.getElementById("die1");
      const die2 = document.getElementById("die2");
      const btn1 = document.getElementById("btn1");
      const btn2 = document.getElementById("btn2");
      const totalDisplay = document.getElementById("totalDisplay");
      const historyList = document.getElementById("historyList");

      // Initialize Die 1 to face 1
      updateDieFace(1, 1);

      /* --- FUNCTIONS --- */

      function setDiceCount(count) {
        if (isRolling) return;
        mode = count;

        // UI Toggles
        if (mode === 1) {
          btn1.className =
            "px-6 py-2 rounded-lg text-sm font-bold transition-all bg-indigo-600 text-white shadow-lg";
          btn2.className =
            "px-6 py-2 rounded-lg text-sm font-bold transition-all text-slate-400 hover:text-white";

          die2.classList.add("hidden", "scale-0", "opacity-0"); // Hide Die 2
          die2.classList.remove("flex");
        } else {
          btn2.className =
            "px-6 py-2 rounded-lg text-sm font-bold transition-all bg-indigo-600 text-white shadow-lg";
          btn1.className =
            "px-6 py-2 rounded-lg text-sm font-bold transition-all text-slate-400 hover:text-white";

          die2.classList.remove("hidden");
          // Small delay to allow display:block to apply before animating opacity
          setTimeout(() => {
            die2.classList.remove("scale-0", "opacity-0");
            updateDieFace(2, 1); // Reset face
          }, 10);
        }
        // Reset Score
        totalDisplay.textContent = "0";
        totalDisplay.className =
          "mono text-5xl text-white font-black transition-all";
      }

      function rollAll() {
        if (isRolling) return;
        isRolling = true;
        document.getElementById("rollBtn").disabled = true;

        // 1. Animate
        die1.classList.add("is-rolling");
        if (mode === 2) die2.classList.add("is-rolling");
        totalDisplay.classList.add("opacity-50", "scale-90"); // Dim score while rolling

        // 2. Resolve Logic after animation (0.6s)
        setTimeout(() => {
          const r1 = Math.floor(Math.random() * 6) + 1;
          const r2 = mode === 2 ? Math.floor(Math.random() * 6) + 1 : 0;
          const total = r1 + r2;

          // Update Visuals
          updateDieFace(1, r1);
          if (mode === 2) updateDieFace(2, r2);

          // Cleanup Animation Classes
          die1.classList.remove("is-rolling");
          die2.classList.remove("is-rolling");

          // Update Score Display
          totalDisplay.textContent = total;
          totalDisplay.classList.remove("opacity-50", "scale-90");

          // CRITICAL HIT CHECK (Max roll)
          const maxPossible = mode * 6;
          if (total === maxPossible) {
            totalDisplay.classList.add("crit-glow");
          } else {
            totalDisplay.classList.remove("crit-glow");
          }

          // Add to History
          addToHistory(total);

          // Reset Button
          isRolling = false;
          document.getElementById("rollBtn").disabled = false;
        }, 600);
      }

      function updateDieFace(dieNum, value) {
        // dieNum is 1 or 2
        // value is 1-6
        const prefix = dieNum === 1 ? "d1" : "d2";

        // Hide all dots for this die
        for (let i = 1; i <= 9; i++) {
          document.getElementById(`${prefix}p${i}`).classList.remove("show");
        }

        // Show calculated dots
        faceConfig[value].forEach((i) => {
          document.getElementById(`${prefix}p${i}`).classList.add("show");
        });
      }

      function addToHistory(val) {
        // Remove "No rolls yet" if it exists
        if (historyList.children[0].textContent.includes("No rolls")) {
          historyList.innerHTML = "";
        }

        const item = document.createElement("div");
        item.className =
          "history-item bg-slate-800 text-white font-bold mono w-10 h-10 flex-shrink-0 flex items-center justify-center rounded-full border border-slate-700 text-sm";
        item.textContent = val;

        // Add colors for high/low rolls in history
        if (val === mode * 6)
          item.classList.add("border-yellow-500", "text-yellow-400");
        else if (val === mode)
          item.classList.add("border-red-900", "text-red-400");

        // Prepend (add to start)
        historyList.prepend(item);

        // Limit history to 10 items
        if (historyList.children.length > 10) {
          historyList.removeChild(historyList.lastChild);
        }
      }

      // Spacebar support
      document.body.onkeyup = (e) => {
        if (e.code === "Space") rollAll();
      };
    </script>
  </body>
</html>
